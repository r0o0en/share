<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>商品详情页-判断APP</title>
		<meta name="author" content=""/>
		<meta name="keywords" content=""/>
		<meta name="description" content=""/>
		
		<meta name="renderer" content="webkit">
		<meta http-equiv= "X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui">
		<meta name="telephone=no" content="format-detection">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		
		<link rel="stylesheet" type="text/css" href="js/weui/weui.min.css"/>
		<link rel="stylesheet" type="text/css" href="js/weui/jquery-weui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		
		<meta name='apple-itunes-app' content='app-id=1156008352'>
	</head>
	<body>
			<div class="open-app">
				<div class="flex">
					<div class="info flex">
						<div class="esc "><i>x</i></div>
						<div class="flex-1 flex">
							<img class="logo" src="img/logo.png" />
							<p>打开吉粮惠民APP购物<br />购买即返回粮票</p>
						</div>
					</div>
					<a class="open-app-btn flex-1" href="HMClient://" id="openApp">打开APP</a>
					<!--<a class="open-app-btn flex-1" href="javascript:;" id="openApp">打开APP</a>-->
				</div>
			</div>
			
		<div class="page" >
			<div class="page-content">
				<section class="swiper-container">
					<div class="swiper-wrapper">
					</div>
					<div class="swiper-pagination"></div>
				</section>
				
				<div class="page-header">
					<h1 class="lib-context">苹果7红色当天发/12期分期APPLE/苹果IPHONE全网通4G国行手机</h1>
					<div class="flex lib-context price-line">
						<div class="flex-1"><span class="cl-red"></span><small><strike></strike></small>	</div>
						<div class="cu-quantity">
							<button class="cu-minus"></button>
							<input  class="cu-input" type="number" value="1" maxlength="" />
							<button class="cu-add" ></button>
						</div>
					</div>
				</div>

				<section class="weui-cells up-hint">
					<a class="weui-cell weui-cell_access" href="javascript:;">
						<div class="weui-cell__bd">
							<p style="text-align: center;">上拉查看图文详情</p>
						</div>
					</a>
				</section>
				
				<div class="load-more-info-content lib-context">
					
				</div>
				
				<div class="weui-loadmore">
				  <i class="weui-loading"></i>
				  <span class="weui-loadmore__tips">正在加载</span>
				</div>
				
				<div class="occupy-footer"></div>
			</div>
			
		</div>
		<footer class="page-footer page-footer-fixed">
				<div class="flex">
					<a href="javascript:;" class="flex-1 weui-btn weui-btn_yello no-radius">加入购物车</a>
					<a href="javascript:;" class="flex-1 weui-btn weui-btn_red no-radius">去结算</a>
				</div>
		</footer>
		
		<!--<script src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>-->
		<!--<script src="//cdn.bootcss.com/jquery-weui/1.0.1/js/jquery-weui.min.js"></script>-->
		<script src="js/zepto/zepto.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/zepto/fx.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/weui/jquery-weui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/swiper-3.4.2.jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/tool-nativeSchema.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/index_load.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function () {
				//接收参数格式示例
//				var demo1 = {
//					"type":"normal", //类型：标准
//					"goodsDesc": "这是一款iphone99手机",
//					"rebateConsumers": 0,
//					"userId": "2188809097248768",  //用户ID
//					"attributeList":"32G 皓银色",
//					"dmId": "2191747021979648", 
//					"storeName":"深圳华为手机专卖店",
//					"goodsName": "大展宏图200g（322元\/g）",
//					"deductPricePercent": 0,
//					"isForeign": 0,
//					"returnPointPercent": 0,
//					"goodsId": "2191747021946880", //商品ID
//					"price":"199", //商品现价
//					"priceBefore":"299", //商品之前的价格
//					"imgs": "http:\/\/img02.jlhmsh.com\/2188809097248768\/FstSzzMMvxVxMn6cSI6UGqUpNKhO1497596116.jpg",  //幻灯图片
//					
//					"descImgs": "http:\/\/img02.jlhmsh.com\/2188809097248768\/ffff3b68c081425ea464deff08dfe74f3771.jpeg,"+ //详情图片
//								"http:\/\/img02.jlhmsh.com\/2188809097248768\/86cb88536aa84c01880532218a7c61295820.jpeg,"+
//								"http:\/\/img02.jlhmsh.com\/2188809097248768\/16f7a4a605d24fa7b0e7902d8e0ff3f24653.jpeg"
//				}
//				var demo2 = {
//					"type":"spellLuck", //类型：拼手气
//					"dmId": "2073008640354816",
//					"attributeList":"32G 皓银色",
//					"goodsName": "（限购5份）测试拼手气",
//					"storeName":"深圳华为手机专卖店",
//					"goodsDesc": "这是一款iphone98手机",
//					"imgs": "http:\/\/img03.jlhmsh.com\/201707\/07\/00dbc14b82a14dfebf83a4d28f59fb2f.jpg ",
//					"periodsNumber": "2017070701",
//					"finishStatus": 1,
//					"limitAmount": "5",
//					"descImgs": "http:\/\/img03.jlhmsh.com\/201707\/07\/00dbc14b82a14dfebf83a4d28f59fb2f.jpg,http:\/\/img03.jlhmsh.com\/201707\/07\/40e6ee5326c146e387dba8d69bdc1a36.jpg "
//				}
				
				var data={},type;
				try{
					//获取url带参
					data = JSON.parse(getRequest().data);
//					for(var i in data ){
//						console.log(i,data[i]);
//					}
					//类型
					type = data.type;
				}catch(e){
					//alert('参数获取错误');
				}
				
				if(!type && $.trim(type).length<1){type ='normal'};
					//幻灯片
					var slide_url = getAttribute(data,"imgs");
					console.log(data);
					if(!slide_url){return false;}
					var arr = getImgurl(slide_url);
					if(!arr) { return false; }
					var str = '';
					for(var i in arr) {
						str += '<div class="swiper-slide"><img src="' + arr[i] + '" alt=""></div>';
					}
					$('.swiper-wrapper').append(str);
					$(".swiper-container").swiper({
						pagination: '.swiper-pagination',
						autoplay: "5000"
					});
					
					//商品名称
					var name = getAttribute(data,'goodsName','暂无名称');
					if(!name){return false;}
					$('.page-header h1').text(name);
					
					//商品价格 || 拼手气进度
					var str = '',
						cuQuantity_data ={};
					if(type == 'normal'){ //标准
						var before = getAttribute(data,'priceBefore'), //原本的价格 
							now = getAttribute(data,'price'); //现在的价格 || 
						if(now) {
							str += '<span class="cl-red">￥'+now+'</span>';
							if(before) {
								str += '<small><strike>￥'+before+'</strike></small>'
							}
						}else{
							str += '<span class="cl-red">暂无</span>';
						}
					}else if(type == 'spellLuck'){
						var all = getAttribute(data,'limitAmount',10),//拼手气 需要的全部份数
							now = getAttribute(data,'finishStatus',0); // 拼手气 现在的份数
						cuQuantity_data.max = all-now;
						str =	'<div class="weui-progress__bar">' +
									'<div class="weui-progress__inner-bar js_progress" style="width: '+(now/all*100)+'%;"></div>' +
									'</div>' +
								'<span class="cl-red">'+now+'份</span><small>/'+all+'份</small>';
					}
					if(str.length<1){return false;}
					$('.price-line > .flex-1').empty().append(str);
					
					//加减控制器
					cuQuantity(cuQuantity_data);
					
					//配置
					var opt = getAttribute(data,'attributeList');
					if(!opt){return false;}
					var str = '<section class="weui-cells">' +
							  '<a class="weui-cell weui-cell_access" href="javascript:;">' +
							  	'<div class="weui-cell__hd"><img class=" ico-30 " src="img/ico-check.png"></div>' +
							    '<div class="weui-cell__bd">' +
							      '<p>已选：'+opt+'</p>' +
							    '</div>' +
			//				    '<div class="weui-cell__ft">' +
			//				    '</div>' +
							  '</a>' +
							'</section>';
					$('.up-hint').before(str);
					
					//店铺名
					var storeName = getAttribute(data,'storeName');
					if(!storeName){return false;}
					var str = '<section class="weui-cells">' +
							  '<a class="weui-cell weui-cell_access" href="javascript:;">' +
							  	'<div class="weui-cell__hd"><img class=" ico-30 " src="img/ico-store.png"></div>' +
							    '<div class="weui-cell__bd">' +
							      '<p>'+storeName+'</p>' +
							    '</div>' +
			//				    '<div class="weui-cell__ft">' +
			//				    '</div>' +
							  '</a>' +
							'</section>';
					$('.up-hint').before(str);
					
					//加载详情
					var goodsDesc = getAttribute(data,'goodsDesc'),
						descImgs = getAttribute(data,'descImgs');
					var str = false;
					if(goodsDesc){
						str = '<p>'+goodsDesc+'</p>';	
					}
					if(descImgs){
						if(!str){str='';};
						var img = getImgurl(descImgs);
						for(i in img){
							str += '<img src="'+img[i]+'" />';
						}
					}
					
					var loading = false,
						callback = function() {
							if(loading) return;
							loading = true;
							$.showLoading();
							setTimeout(function() {
								$.hideLoading();
								if(str){
									loading = false;
									$('.load-more-info-content ').append(str);
									str = false;
								}else{
									$.toast("没有更多了", "text");
									callback = function(){};
									$('.page-content').destroyInfinite();
									$('.weui-loadmore').animate({
										'height':'0px',
										'opacity':'0',
										'margin':'0 auto'
									},400);
								}
							}, 1500); //模拟延迟 
						};
				window.onload=function () {
					$('.page').infinite(25).on("infinite",callback);
					$('.page').addClass('yjjs');
				};

				//加载打开APP
				$(".open-app").addClass('show');
				$(".open-app .esc").on('click',function (e) {
					$(".open-app").removeClass('show');
					setTimeout(function () {
						$(".open-app").remove();
					},400)
				})
				$("#openApp").on('click',function(e){
					e.preventDefault();
					nativeSchema.loadSchema();
				});
				
				
		})	
		</script>
	</body>
</html>
